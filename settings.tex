% CREATED BY DAVID FRIsK, 2016
\documentclass[12pt, a4paper, twoside, openright]{report}

% BASIC SETTINGS
\usepackage{moreverb}                % List settings
\usepackage[leqno]{amsmath}                % Mathematical expressions (American mathematical society)
\usepackage{amssymb}                % Mathematical symbols (American mathematical society)
\usepackage{amsthm}
\usepackage[dvipsnames]{xcolor}
\usepackage{graphicx}                % Figures
\usepackage{titling}
\usepackage{unicode-math}
\usepackage[backend=biber, urldate=iso, date=iso, style=trad-abbrv]{biblatex}

\addbibresource{references.bib}

\numberwithin{equation}{chapter}    % Numbering order for equations
\numberwithin{figure}{chapter}      % Numbering order for figures
\numberwithin{table}{chapter}        % Numbering order for tables

\usepackage[top=3cm, bottom=3cm, inner=3cm, outer=3cm, headheight=16pt]{geometry}

\usepackage{eso-pic}                % Create cover page background
\newcommand{\backgroundpic}[3]{
  \put(#1,#2){
  \parbox[b][\paperheight]{\paperwidth}{
  \centering
  \includegraphics[width=\paperwidth,height=\paperheight,keepaspectratio]{#3}}}}
\usepackage{float}     % Enables object position enforcement using [H]
\usepackage{lipsum}
\usepackage{datetime} %date formatting tools

\makeatletter
\long\def\subtitle#1{\gdef\thesubtitle{#1}}

\newcommand{\multilinetitle}[1]{%
  \newcommand\themultilinetitle{#1}
}

\def\supervisor#1{\gdef\thesupervisor{#1}}
\def\thesupervisor{\@latex@warning@no@line{No \noexpand\supervisor given}}

\def\examiner#1{\gdef\theexaminer{#1}}
\def\theexaminer{\@latex@warning@no@line{No \noexpand\examiner given}}

\def\departmentofsupervisor#1{\gdef\thedepartmentofsupervisor{#1}}
\def\thedepartmentofsupervisor{\@latex@warning@no@line{No \noexpand\departmentofsupervisor given}}

\def\departmentofexaminer#1{\gdef\thedepartmentofexaminer{#1}}
\def\thedepartmentofexaminer{\@latex@warning@no@line{No \noexpand\departmentofexaminer given}}

\def\division#1{\gdef\thedivision{#1}}

\def\keywords#1{\gdef\thekeywords{#1}}

\newcommand{\coverimage}[2]{%
  \if\relax#1\relax
  \ClassError{chalmers-msc-report}{%
    \noexpand\coverimage: Empty IMAGE-PATH \MessageBreak
    Usage: \noexpand\coverimage{IMAGE-PATH}{IMAGE-CAPTION}
  }{%
    You called \noexpand\coverimage like this: \protect\coverimage{}{#2} (or in some other way that caused LaTeX to think that the second argument is empty), but IMAGE-PATH cannot be empty. \MessageBreak
    Insert a path to \noexpand\coverimage first argument, i.e. \noexpand\coverimage{path/to/my-graphic}{#2}.
  }
  \else
  \gdef\thecoverimage{#1}
  \fi
  \if\relax#2\relax
  \ClassError{chalmers-msc-report}{%
    \noexpand\coverimage: Empty IMAGE-CAPTION \MessageBreak
    Usage: \noexpand\coverimage{IMAGE-PATH}{IMAGE-CAPTION}
  }{%
    You called \noexpand\coverimage like this: `\noexpand\coverimage{#1}` (or in some other way that caused LaTeX to think that the second argument is empty), but IMAGE-CAPTION cannot be empty. \MessageBreak
    Insert a caption to \noexpand\coverimage second argument, i.e. `\noexpand\coverimage{#1}{My caption}`.
  }
  \else
  \gdef\thecoverimagecaption{#2}
  \fi
}
\makeatother

% These lengths keep track of the user requested lengths. Since some
% commands and environments change these lengths we need to store them
% in order to restore them.
\newlength\oldparskip{}
\newlength\oldparindent{}

\renewenvironment{abstract}
  {\newpage
   \noindent\thetitle{}\\
   \theauthor{}\\
   Department of Computer Science and Engineering\\
   Chalmers University of Technology and University of Gothenburg

   \thispagestyle{plain} % Supress header
   \section*{Abstract}
  }
  {% KEYWORDS (MAXIMUM 10 WORDS)
   \vfill
   Keywords: \thekeywords

   \newpage  % Create empty back of side
   \thispagestyle{empty}
   \mbox{}
   }

\newenvironment{acknowledgements}
  {\newpage
   \thispagestyle{plain}      % Supress header
   \section*{Acknowledgements}
  }
  {\vspace{1.5cm}\vspace{\baselineskip}
   \hfill
   \begin{flushright}
     \theauthor, Gothenburg, \monthname \space \the\year
   \end{flushright}
   \newpage % Create empty back of side
   \thispagestyle{empty}
   \mbox{}
  }

% OPTIONAL SETTINGS (DELETE OR COMMENT TO SUPRESS)

% Caption settings (aligned left with bold name)
\usepackage[
    labelfont=bf
  , textfont=normal
  , justification=justified
  , singlelinecheck=false
]{caption}


% Activate clickable links in table of contents
\usepackage{hyperref}


% Define the number of section levels to be included in the t.o.c. and numbered  (3 is default)
\setcounter{tocdepth}{5}
\setcounter{secnumdepth}{5}


% Chapter title settings
\usepackage{titlesec}
\titleformat{\chapter}[display]
  {\Huge\bfseries\filcenter}
  {{\fontsize{50pt}{1em}\vspace{-4.2ex}\selectfont \textnormal{\thechapter}}}{1ex}{}[]


% Header and footer settings (Select TWOSIDE or ONESIDE layout below)
\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter.\space#1}{}}

\fancyhf{}
\fancyhead[LE,RO]{\nouppercase{ \leftmark}}
\fancyfoot[LE,RO]{\thepage}
\fancypagestyle{plain}{      % Redefine the plain page style
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[LE,RO]{\thepage}}
